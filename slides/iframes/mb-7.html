<script type="text/javascript" charset="utf-8">

window.mathBoxSetup = function (mathbox) {

  mathbox
    .viewport({
      type: 'cartesian',
      range: [[-4, 4], [-4, 4]],
      scale: [1.29, .65],
    })
    .grid({
      color: 0xB0B0B0,
      ticks: [4, 4],
      zIndex: -1,
      opacity: 0.001,
    })
    .axis({
      axis: 0,
      color: 0x909090,
      ticks: 4,
      lineWidth: 4,
      opacity: 0.001,
    })
    .axis({
      axis: 1,
      color: 0x909090,
      ticks: 4,
      lineWidth: 4,
      opacity: 0.001,
    })
    .curve({
      id: 'fdots',
      n: 9,
      domain: [-4, 4],
      expression: function (x) {
        return x;
      },
      points: true,
      line: false,
      live: true,
      pointSize: 15,
      zIndex: 1,
      opacity: 0.001,
    });

}

function atanDiff(x, end) {
  x -= 3;
  if (x >= 0) x += 1;
  return [x, end ? Math.atan(x) : x];
}

window.mathBoxScript = [

  [],

  // Grid
  [
    ['animate', 'grid, axis, curve', {
      opacity: 1,
    }]
  ],

  // Continuous function
  [
    ['remove', 'curve'],
    ['animate', 'viewport', {
      range: [[-6, 6], [-6, 6]],
      scale: [1.935, .975],
    }, { duration: 600 }],
    ['add', 'curve', {
      id: 'f',
      n: 128,
      domain: [-4, 4],
      expression: function (x) {
        return x;
      },
      points: false,
      line: true,
      live: true,
      lineWidth: 6,
      zIndex: 1,
    }],
    ['animate', '#f', {
      domain: [-6, 6],
    }, { duration: 600 }],
  ],

  // x/2
  [
    ['animate', '#f', {
      expression: function (x) {
        return x/2;
      },
    }, {
      duration: 300,
    }],
  ],

  // x/2 + 1
  [
    ['animate', '#f', {
      expression: function (x) {
        return x/2 + 1;
      },
    }, {
      duration: 300,
    }],
  ],

  // atan x
  [
    ['animate', '#f', {
      expression: function (x) {
        return 2*Math.atan(x);
      },
    }, {
      duration: 300,
    }],
  ],

  // sin x
  [
    ['add', 'curve', {
      id: 'g',
      n: 128,
      domain: [-4, 4],
      expression: function (x) {
        return Math.sin(8*x);
      },
      points: false,
      line: true,
      live: true,
      lineWidth: 6,
      zIndex: 1,
      color: 0x20C050,
    }, {
      duration: 400
    }],
  ],

  // Add up f + g
  [
    ['animate', '#f', {
      expression: function (x) {
        return 2*Math.atan(x)+Math.sin(8*x);
      },
      color: 0xC02050,
    }, {
      duration: 600,
    }],
    ['animate', '#g', {
      expression: function (x) {
        return 2*Math.atan(x)+Math.sin(8*x);
      },
      color: 0xC02050,
    }, {
      duration: 600,
    }],
  ],

  // New f = cosine bump
  [
    ['remove', 'curve'],
    ['add', 'curve', {
      id: 'f',
      n: 128,
      domain: [-4, 4],
      expression: function (x) {
        return Math.cos(x) + 1;
      },
      points: false,
      line: true,
      live: true,
      lineWidth: 6,
      zIndex: 1,
    }],
  ],

  // New g = sine
  [
    ['add', 'curve', {
      id: 'g',
      n: 128,
      domain: [-4, 4],
      expression: function (x) {
        return Math.sin(8*x);
      },
      points: false,
      line: true,
      live: true,
      lineWidth: 6,
      zIndex: 1,
      color: 0x20C050,
    }, {
      duration: 400
    }],
  ],

  [
    ['animate', 'viewport', {
      scale: [1.29, 1.3],
    }],
    ['add', 'curve', {
      id: 'i',
      n: 64,
      domain: [-4, 4],
      expression: function (x) {
        return x;
      },
      points: false,
      line: true,
      live: true,
      lineWidth: 6,
      zIndex: 1,
      color: 0x909090,
    }],
  ],

  [
    ['remove', 'curve'],
    ['add', 'vector', {
      n: 6,
      expression: atanDiff,
      lineWidth: 3,
    }],
    ['add', 'curve', {
      id: 'f',
      n: 128,
      domain: [-4, 4],
      expression: function (x) {
        return x;
      },
      points: false,
      line: true,
      live: true,
      lineWidth: 6,
      zIndex: 1,
    }],
  ],

];

</script>
